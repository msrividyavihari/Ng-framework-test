configurations {
    liquibaseRuntime.extendsFrom runtime
}

dependencies {

    liquibaseRuntime "org.liquibase:liquibase-core:$LIQUIBASE"
    liquibaseRuntime 'org.liquibase:liquibase-groovy-dsl:2.1.1'
    liquibaseRuntime "org.liquibase.ext:liquibase-hibernate5:$LIQUIBASE"
    liquibaseRuntime "com.oracle.database.jdbc:ojdbc8:$ORACLE_DRIVER"
    liquibaseRuntime "info.picocli:picocli:$PICOCLI"
    liquibaseRuntime "com.deloitte.nextgen.framework:ng-persistence:$NEXTGEN"

    liquibaseRuntime sourceSets.main.compileClasspath
}

if (!project.hasProperty("runList")) {
    project.ext.runList = "main"
}


project.ext {
    initial = 'src/main/resources/liquibase/changelog/00000000000000_initial.xml'
    master = 'src/main/resources/liquibase/master.xml'
    changelogFile = 'src/main/resources/liquibase/changelog/' + new Date().format('ddMMyyyyHHmmss') + '_changelog.xml'
    diffChangelogFile = 'src/main/resources/liquibase/changelog/' + new Date().format('ddMMyyyyHHmmss') + '_diffchangelog.xml'
}

diffChangeLog.dependsOn compileJava
update.dependsOn compileJava

liquibase {
    mainClassName 'liquibase.integration.commandline.LiquibaseCommandLine'
    runList = project.ext.runList
    activities {
        main {
            logLevel "debug"
            driver 'oracle.jdbc.OracleDriver'
            url 'jdbc:oracle:thin:@//localhost:1522/ORCL'
            username 'IE_TEST_DB'
            password 'IE_TEST_DB'
            changelogFile project.ext.initial
            defaultSchemaName ""
            classpath "src/main/resources/"
        }
        changeLog {
            logLevel "debug"
            driver 'oracle.jdbc.OracleDriver'
            url 'jdbc:oracle:thin:@//localhost:1522/ORCL'
            username 'IE_TEST_DB'
            password 'IE_TEST_DB'
            changelogFile project.ext.changelogFile
            defaultSchemaName ""
            classpath "src/main/resources/"
        }
        diffChangelog {
            logLevel "debug"
            driver 'oracle.jdbc.OracleDriver'
            url 'jdbc:oracle:thin:@//localhost:1522/ORCL'
            username 'IE_TEST_DB'
            password 'IE_TEST_DB'
            changelogFile project.ext.diffChangelogFile
            classpath "$buildDir/classes/java/main"
            referenceUrl 'hibernate:spring:com.deloitte.nextgen.demo.client?dialect=org.hibernate.dialect.Oracle12cDialect&hibernate.physical_naming_strategy=com.deloitte.nextgen.framework.persistence.strategy.NGPhysicalNamingStrategy&hibernate.implicit_naming_strategy=org.hibernate.boot.model.naming.ImplicitNamingStrategyJpaCompliantImpl'
        }
        update {
            logLevel "debug"
            driver 'oracle.jdbc.OracleDriver'
            url 'jdbc:oracle:thin:@//localhost:1522/ORCL'
            username 'IE_TEST_DB'
            password 'IE_TEST_DB'
            changelogFile project.ext.master
            defaultSchemaName ""
            classpath "src/main/resources/"
        }
    }
}